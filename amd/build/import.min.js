define ("local_learning_analytics/import",["core/ajax","jquery"],function(a,b){var h,i,j=0,k=!1;function c(c,a){return c-a}function d(){var a=100*((p+o.length)/m),b="";if(!k){b=" <strong>(not running)</strong>"}var c="";if(0!==o.length){c=" (minuserid: "+p+")"}i.val(a);h.html("<p>"+a.toFixed(2)+"% "+b+"</p><p>Users done: "+(p+o.length)+c+"</p><p>Save point: "+j+"</p><p>Next user: "+l+"</p><p>Working on users: "+n.join(", ")+"</p>")}var l,m=1,n=[],o=[],p;function e(b){a.call([{methodname:"local_learning_analytics_ajax_import",args:{action:"savepoint",userid:b,offset:0}}])[0].done(function(){j=b}).fail(function(a){alert("An unrevolerable error occured during import: "+a.message)})}function f(b,g){b=b||l;g=g||0;if(b>m){k=!1}if(!k&&0===g){d();return}if(n.length<6||0!==g){(function(b,d){a.call([{methodname:"local_learning_analytics_ajax_import",args:{action:"import",userid:b,offset:d}}])[0].done(function(a){m=Math.max(m,a.maxUserid);if(-1===a.nextOffset){var d=n.indexOf(b);n.splice(d,1);o.push(b);o.sort(c);while(o[0]===p+1){p=o.shift();if(0==p%100){e(p)}}f()}else{f(b,a.nextOffset)}})})(b,g);if(0===g){n.push(b);l++;d()}f()}}function g(){k=!0;f()}return{init:function init(a,c){p=a;l=p+1;m=c;j=a;i=b("<progress class=\"progress progress-striped progress-animated\" value=\"0\" max=\"100\"></progress>");h=b("<div></div>");b("#import_info").append(i).append(h);b("#start_import_btn").click(function(){g()});b("#stop_import_btn").click(function(){k=!1});d()}}});
//# sourceMappingURL=import.min.js.map
